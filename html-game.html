<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Romanian Football Player Guesser</title>
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Russo One', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            overflow-x: hidden;
            width: 100%;
            color: #fff;
        }

        html {
            height: -webkit-fill-available;
        }

        .container {
            max-width: 750px;
            margin-bottom: 4rem;
            padding: 20px;
            background: rgba(0, 0, 0, 0.85);
            border-radius: 0px 0px 20px 20px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3),
                inset 0 0 100px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            height: auto;
            -webkit-overflow-scrolling: touch;
        }

        #image-container {
            max-width: 750px;
            border-radius: 20px 20px 0px 0px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3),
                inset 0 0 100px rgba(255, 255, 255, 0.1);
            margin-top: 2rem;
        }

        #image-container img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 20px 20px 0px 0px;
        }

        h1 {
            text-align: center;
            color: #fff;
            font-size: 2.5em;
            text-transform: uppercase;

            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
            margin-bottom: 30px;
        }

        .search-container {
            position: relative;
            margin: 20px 0;
        }

        #player-search {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            transition: all 0.3s ease;
        }

        #player-search:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
        }

        .grid-headers {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
            margin-top: 20px;
            align-items: center;
            text-align: center;
        }

        .attempt {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 15px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 10px;
            align-items: center;
            text-align: center;
        }

        .attempt-label {
            grid-column: 1 / -1;
            text-align: left;
            padding: 5px 15px;
            color: #fff;
            font-size: 1.1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .attempt-number {
            font-weight: bold;
            color: #4CAF50;
        }

        .dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 400px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            backdrop-filter: blur(10px);
            z-index: 1000;
        }

        .dropdown-item {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            align-items: center;
            cursor: pointer;
        }

        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.02);
        }

        .player-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .team-logo {
            width: 30px;
            height: 30px;
            object-fit: contain;
        }

        .player-info-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            align-items: center;
        }

        .stat-container {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9em;
        }

        .stat-icon {
            opacity: 0.7;
        }

        /* Custom scrollbar for dropdown */
        .dropdown::-webkit-scrollbar {
            width: 8px;
        }

        .dropdown::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .dropdown::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        .dropdown::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        /* Attempt info styling */
        .attempt-info {
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            min-height: 50px;
            margin: 0 auto;
        }

        .attempt-info img {
            max-width: 100%;
            max-height: 40px;
            object-fit: contain;
        }

        .arrow {
            margin-left: 5px;
            font-weight: bold;
            opacity: 0.8;
        }

        .attempt:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .attempt-info {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.1);
            width: 70px;
            height: 70px;
            transition: all 0.3s ease;
            transform-style: preserve-3d;
        }

        .attempt-info:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .correct {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
            border: none;
        }

        .partial {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            box-shadow: 0 0 20px rgba(255, 152, 0, 0.5);
            border: none;
        }

        .incorrect {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            box-shadow: 0 0 20px rgba(244, 67, 54, 0.5);
            border: none;
        }

        .hidden {
            display: none;
        }

        #game-over {
            text-align: center;
            margin-top: 20px;
        }

        #play-again {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
            transition: all 0.3s ease;
        }

        #play-again:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
        }

        #remaining-guesses {
            font-size: 1.2em;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
        }

        #hint-button {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
            transition: all 0.3s ease;
        }

        #hint-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(33, 150, 243, 0.4);
        }

        #hint-text {
            display: none;
            /* Hide by default */
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        @keyframes glow {
            from {
                box-shadow: none;
            }

            to {
                box-shadow: none;
            }
        }

        #game-over {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 30px 50px;
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            z-index: 9999;
            text-align: center;
            min-width: 320px;
        }

        #game-over h2 {
            color: #fff;
            margin-bottom: 20px;
            font-size: 1.8em;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 999;
            display: none;
        }

        .overlay.active {
            display: block;
        }

        @media screen and (max-width: 768px) {
            body {
                width: 100%;
                height: 100%;
                overflow-y: auto;
            }

            .container {
                margin: 0;
                border-radius: 0;
                padding: 20px;
                min-height: 100vh;
            }

            .container h1:nth-child(1) {
                margin-top: 3em;
            }

            #game-container {
                display: flex;
                flex-direction: column;
            }

            h1 {
                font-size: 1.8em;
                margin-bottom: 15px;
            }

            .grid-headers {
                font-size: 0.8em;
                padding: 8px;
            }

            .attempt {
                font-size: 0.8em;
                padding: 8px;
            }

            .attempt-info {
                width: 50px;
                height: 50px;
                padding: 5px;
            }

            .attempt-info img {
                max-height: 30px;
            }

            .dropdown-item {
                display: grid;
                grid-template-columns: auto 1fr auto;
                grid-template-areas:
                    "img name team"
                    "img stats stats";
                gap: 10px;
                padding: 15px;
            }

            .player-img {
                grid-area: img;
                width: 50px;
                height: 50px;
            }

            .dropdown-item>div:nth-child(2) {
                grid-area: name;
                font-size: 1em;
            }

            .team-logo {
                grid-area: team;
                width: 30px;
                height: 30px;
            }

            .player-info-grid {
                grid-area: stats;
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 8px;
                font-size: 0.85em;
                background: rgba(255, 255, 255, 0.05);
                padding: 8px;
                border-radius: 8px;
                margin-top: 5px;
            }

            .stat-container {
                display: flex;
                align-items: center;
                gap: 4px;
                justify-content: center;
            }

            .stat-icon {
                opacity: 0.7;
                font-size: 0.9em;
            }

            .dropdown {
                max-height: 50vh;
                border-radius: 15px;
            }

            .attempt-label {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            #remaining-guesses {
                font-size: 1em;
                padding: 8px 15px;
                width: 100%;
                text-align: center;
                margin-bottom: 10px;
            }

            #hint-button {
                padding: 8px 16px;
                font-size: 0.9em;
                width: 100%;
                white-space: normal;
                line-height: 1.2;
            }

            /* Mobile search improvements */
            .search-container {
                margin-bottom: 10px;
            }

            .dropdown {
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                max-height: 50vh;
                border-radius: 15px;
                z-index: 1001;
            }

            /* Remove the previous fixed positioning styles */
            .dropdown {
                position: absolute;
                bottom: auto;
            }

            /* Basic player info for mobile */
            .mobile-player-info {
                display: block;
                grid-area: info;
                font-size: 0.8em;
                color: #888;
            }

            /* Game over modal adjustments */
            #game-over {
                width: 90%;
                padding: 20px;
            }

            #game-over h2 {
                font-size: 1.5em;
            }

            #image-container {
                margin-top: 0;
            }
        }


        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-content {
            background: rgba(0, 0, 0, 0.85);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
        }

        .loading-progress {
            width: 300px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 0.3s ease;
        }

        .loading-text {
            font-size: 14px;
            opacity: 0.8;
        }

        .correct-guesses {
            background: rgba(76, 175, 80, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .correct-guesses.hidden {
            display: none;
        }

        .correct-guesses h3 {
            margin: 0 0 10px 0;
            color: #4CAF50;
            font-size: 1.1em;
        }

        .guessed-attributes {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .guessed-attribute {
            background: rgba(76, 175, 80, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .guessed-attribute img {
            width: 20px;
            height: 20px;
            object-fit: contain;
        }

        @media screen and (max-width: 768px) {
            .correct-guesses {
                padding: 10px;
                margin-top: 15px;
            }

            .guessed-attribute {
                padding: 6px 12px;
                font-size: 0.9em;
            }

            #image-container img, #image-container {
                border-radius: 0px;
            }
        }

        .curved-text {
            font-size: 2em;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            transform: perspective(500px) rotateX(30deg);
            margin-bottom: 40px;
            font-family: 'Russo One', sans-serif;
        }

        .rules-container {
            max-width: 1000px;
            margin-top: 2rem;
            padding: 20px;
            background: rgba(0, 0, 0, 0.85);
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3),

                inset 0 0 100px rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: #fff;
        }

        .rules-container h2 {
            color: #4CAF50;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .rules-container ul {
            list-style-type: none;
            padding: 0;
        }

        .rules-container li {
            margin-bottom: 15px;
            padding-left: 25px;
            position: relative;
        }

        .rules-container li:before {
            content: "‚Ä¢";
            color: #4CAF50;
            font-size: 1.5em;
            position: absolute;
            left: 0;
            top: -5px;
        }

        @media screen and (max-width: 768px) {
            .rules-container {
                padding: 15px;
            }

            .rules-container li {
                font-size: 0.9em;
            }

            .curved-text {
                font-size: 1.5em;
                margin-bottom: 20px;
            }
        }

    </style>
</head>

<body>
    <div id="image-container">
        <a href="https://fotbal-comedie.ro" target="_blank"><img src="https://fotbal-comedie.ro/wp-content/uploads/2025/02/banner-fotbal-comedie.jpg"
            alt="Fotbal Comedie Logo" style="width: 100%; height: auto; display: block;"></a>
    </div>
    <div class="container">

        <div id="game-container">
            <div class="search-container">
                <input type="text" id="player-search" placeholder="Introdu numele jucatorului...">
                <div id="dropdown" class="dropdown"></div>
            </div>

            <div id="remaining-guesses">Incercari ramase: 8</div>
            <button id="hint-button">Indiciu (costa 1 incercare)</button>
            <div id="hint-text"></div>

            <div id="correct-guesses" class="correct-guesses hidden">
                <h3>Ai ghicit corect:</h3>
                <div class="guessed-attributes"></div>
            </div>

            <div class="grid-headers hidden">
                <div>TEAM</div>
                <div>POS</div>
                <div>NAT</div>
                <div>SHIRT</div>
                <div>AGE</div>
            </div>
            <div id="attempts-container"></div>

            <div id="game-over" class="hidden">
                <h2 id="game-over-message"></h2>
                <button id="play-again">Play Again</button>
            </div>
            <div class="overlay"></div>
        </div>

        <div class="rules-container">
            <h2>Regulile Jocului</h2>
            <ul>
                <li>doar jucatori din Superliga (momentan)</li>
                <li>ai 8 incercari pentru a ghici fotbalistul</li>
                <li>poti folosi 3 indicii, dar fiecare va costa o incercare</li>
                <li>pozitia jucatorului poate fi GK (portar), DF (fundas), MID (mijlocas), W (winger) sau CF (atacant
                    central)</li>
                <li>sagetile din dreptul caracteristicelor iti pot oferi indicii legate de jucator. De exemplu, in
                    dreptul varstei daca avem 25 cu o sageata in sus, inseamna ca varsta jucatorului este mai mare de 25
                    de ani.</li>
            </ul>
        </div>
    </div>

    <script>
        let players = [];
        let targetPlayer = null;
        let remainingGuesses = 8;
        let gameOver = false;
        let hintsRemaining = 3;
        let usedHints = new Set();

        async function fetchPlayers() {
            try {
                // Show loading screen
                const loadingDiv = document.createElement('div');
                loadingDiv.id = 'loading-screen';
                loadingDiv.innerHTML = `
                    <div class="loading-content">
                        <h2>Se incarca jocul...</h2>
                        <div class="loading-progress">
                            <div class="progress-bar"></div>
                        </div>
                        <div class="loading-text">Aducem jucatorii pe teren (0%)</div>
                    </div>
                `;
                document.body.appendChild(loadingDiv);

                // Fetch players data
                const response = await fetch('https://cryptobully.s3.eu-north-1.amazonaws.com/fotbal-comedie/superliga_players.json');
                players = await response.json();

                // Preload all images
                const totalImages = players.length;
                let loadedImages = 0;

                const preloadPromises = players.map(player => {
                    return new Promise((resolve) => {
                        const img = new Image();
                        img.onload = () => {
                            loadedImages++;
                            updateLoadingProgress(loadedImages, totalImages);
                            resolve();
                        };
                        img.onerror = () => {
                            // Try JPG if PNG fails
                            img.src = `https://cryptobully.s3.eu-north-1.amazonaws.com/fotbal-comedie/player_images/${player.PlayerID}.jpg`;
                            img.onerror = () => {
                                loadedImages++;
                                updateLoadingProgress(loadedImages, totalImages);
                                resolve();
                            };
                        };
                        img.src = `https://cryptobully.s3.eu-north-1.amazonaws.com/fotbal-comedie/player_images/${player.PlayerID}.png`;
                    });
                });

                // Wait for all images to load
                await Promise.all(preloadPromises);

                // Remove loading screen and start game
                document.body.removeChild(loadingDiv);
                startNewGame();
            } catch (error) {
                console.error('Error fetching players:', error);
            }
        }

        function updateLoadingProgress(loaded, total) {
            const percentage = Math.round((loaded / total) * 100);
            const progressBar = document.querySelector('.progress-bar');
            const loadingText = document.querySelector('.loading-text');

            progressBar.style.width = `${percentage}%`;
            loadingText.textContent = `Aducem jucatorii pe teren (${percentage}%)`;
        }

        function startNewGame() {
            targetPlayer = getWeightedRandomPlayer();
            remainingGuesses = 8;
            gameOver = false;
            usedHints = new Set();
            document.getElementById('attempts-container').innerHTML = '';
            document.getElementById('game-over').classList.add('hidden');
            document.getElementById('remaining-guesses').textContent = `Incercari ramase: ${remainingGuesses}`;
            document.getElementById('player-search').value = '';
            document.getElementById('hint-text').textContent = '';
            document.getElementById('hint-text').style.display = 'none';
            hintsRemaining = 3;
            updateHintButtonText();
            document.querySelector('.overlay').classList.remove('active');
            document.querySelector('.grid-headers').classList.add('hidden');
            document.getElementById('correct-guesses').classList.add('hidden');
            document.querySelector('.guessed-attributes').innerHTML = '';
        }

        function getWeightedRandomPlayer() {
            // Define weights for each score (total = 100%)
            const weights = {
                5: 0.50, // 50% chance for score 5
                4: 0.25, // 25% chance for score 4
                3: 0.15, // 15% chance for score 3
                2: 0.07, // 7% chance for score 2
                1: 0.03  // 3% chance for score 1
            };

            // Generate a random number between 0 and 1
            const random = Math.random();

            // Create score groups
            const playersByScore = {};
            for (let i = 1; i <= 5; i++) {
                playersByScore[i] = players.filter(p => p.Scor === i);
            }

            // Determine which score group to pick from based on the random number
            let cumulativeWeight = 0;
            for (let score = 5; score >= 1; score--) {
                cumulativeWeight += weights[score];
                if (random <= cumulativeWeight) {
                    // If this score group has no players, fall back to the next available group
                    let currentScore = score;
                    while (currentScore >= 1 && playersByScore[currentScore].length === 0) {
                        currentScore--;
                    }
                    if (currentScore < 1) {
                        // If no players found in lower scores, try higher scores
                        currentScore = score + 1;
                        while (currentScore <= 5 && playersByScore[currentScore].length === 0) {
                            currentScore++;
                        }
                    }
                    // If we found a group with players, select randomly from it
                    if (currentScore >= 1 && currentScore <= 5 && playersByScore[currentScore].length > 0) {
                        const groupPlayers = playersByScore[currentScore];
                        return groupPlayers[Math.floor(Math.random() * groupPlayers.length)];
                    }
                }
            }

            // Fallback to completely random selection if something goes wrong
            return players[Math.floor(Math.random() * players.length)];
        }

        function updateHintButtonText() {
            const button = document.getElementById('hint-button');
            if (window.innerWidth <= 768) {
                button.textContent = `Indiciu (${hintsRemaining}/3)`;
            } else {
                button.textContent = `Indiciu (costa 1 incercare) (${hintsRemaining} ramase)`;
            }
        }

        function createPlayerImage(playerID) {
            // Try to load PNG first, fallback to JPG if PNG fails
            const img = new Image();
            img.src = `https://cryptobully.s3.eu-north-1.amazonaws.com/fotbal-comedie/player_images/${playerID}.png`;
            img.onerror = () => {
                img.src = `https://cryptobully.s3.eu-north-1.amazonaws.com/fotbal-comedie/player_images/${playerID}.jpg`;
            };
            return img.src;
        }

        function createTeamLogo(teamID) {
            // Try to load PNG first, fallback to JPG if PNG fails
            const img = new Image();
            img.src = `https://cryptobully.s3.eu-north-1.amazonaws.com/fotbal-comedie/team_logos/${teamID}.png`;
            img.onerror = () => {
                img.src = `https://cryptobully.s3.eu-north-1.amazonaws.com/fotbal-comedie/team_logos/${teamID}.jpg`;
            };
            return img.src;
        }

        function getAge(dateString) {
            // Extract the date part before the parentheses
            const matches = dateString.match(/([A-Za-z]+ \d+, \d{4})/);
            if (!matches) return 0;

            const birthDate = new Date(matches[1]);
            const today = new Date();

            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();

            // Adjust age if birthday hasn't occurred this year
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }

            return age;
        }

        function mapPosition(position) {
            // Standardize position formatting
            position = position.toLowerCase().trim();

            // Goalkeeper
            if (position.includes('goalkeeper')) {
                return 'GK';
            }

            // Defenders
            if (position.includes('back')) {
                return 'DF';
            }

            // Midfielders
            if (position.includes('midfield')) {
                return 'CM';
            }

            // Wingers
            if (position.includes('winger')) {
                return 'W';
            }

            // Forwards/Strikers
            if (position.includes('forward') || position.includes('striker')) {
                return 'CF';
            }

            return position; // Return original if no match
        }

        function compareValue(actual, target, element, type, teamID) {
            element.className = 'attempt-info';

            if (type === 'position') {
                actual = mapPosition(actual);
                target = mapPosition(target);
            }

            // Convert string numbers to integers for proper comparison
            if (type === 'number') {
                actual = parseInt(actual);
                target = parseInt(target);
            }

            if (actual === target) {
                element.classList.add('correct');
            } else {
                element.classList.add('incorrect');
            }

            switch (type) {
                case 'team':
                    const teamLogo = document.createElement('img');
                    teamLogo.className = 'team-logo';
                    teamLogo.src = `https://cryptobully.s3.eu-north-1.amazonaws.com/fotbal-comedie/team_logos/${teamID}.png`;
                    teamLogo.onerror = () => {
                        teamLogo.src = `https://cryptobully.s3.eu-north-1.amazonaws.com/fotbal-comedie/team_logos/${teamID}.jpg`;
                    };
                    element.appendChild(teamLogo);
                    break;
                case 'nationality':
                    const flagImg = document.createElement('img');
                    flagImg.className = 'flag';
                    const countryCode = getCountryCode(actual);
                    flagImg.src = `https://flagcdn.com/w40/${countryCode}.png`;
                    flagImg.title = actual;
                    element.appendChild(flagImg);
                    break;
                case 'number':
                case 'age':
                    element.textContent = actual;
                    if (actual !== target) {
                        const arrow = document.createElement('span');
                        arrow.className = 'arrow';
                        arrow.textContent = actual > target ? '‚Üì' : '‚Üë';
                        element.appendChild(arrow);
                    }
                    break;
                default:
                    element.textContent = actual;
            }

            return element;
        }

        function getCountryCode(country) {
            const countryMap = {
                'Romania': 'ro',
                'Czech Republic': 'cz',
                'South Africa': 'za',
                'Cameroon': 'cm',
                'Montenegro': 'me',
                'Benin': 'bj',
                'Ghana': 'gh',
                'Italy': 'it',
                'Morocco': 'ma',
                'Belgium': 'be',
                'Switzerland': 'ch',
                'Germany': 'de',
                'Norway': 'no',
                'Slovakia': 'sk',
                'Cape Verde': 'cv',
                'Estonia': 'ee',
                'Kosovo': 'xk',
                'Serbia': 'rs',
                'Gabon': 'ga',
                'Nigeria': 'ng',
                'Honduras': 'hn',
                'North Macedonia': 'mk',
                'Croatia': 'hr',
                'Equatorial Guinea': 'gq',
                'Spain': 'es',
                'Georgia': 'ge',
                'Japan': 'jp',
                'France': 'fr',
                'Cuba': 'cu',
                'Costa Rica': 'cr',
                'Bosnia-Herzegovina': 'ba',
                'Brazil': 'br',
                'Slovenia': 'si',
                'The Gambia': 'gm',
                'Ukraine': 'ua',
                'Portugal': 'pt',
                'Mauritania': 'mr',
                'Cote d\'Ivoire': 'ci',
                'Greece': 'gr',
                'Liberia': 'lr',
                'Moldova': 'md',
                'Lithuania': 'lt',
                'Argentina': 'ar',
                'Senegal': 'sn',
                'Armenia': 'am',
                'Tunisia': 'tn',
                'Hungary': 'hu',
                'Albania': 'al',
                'Togo': 'tg',
                'Bulgaria': 'bg',
                'Denmark': 'dk',
                'Madagascar': 'mg',
                'Sweden': 'se',
                'Finland': 'fi',
                'United States': 'us',
                'Congo': 'cg',
                'T√ºrkiye': 'tr',
                'Luxembourg': 'lu',
                'Colombia': 'co',
                'Burkina Faso': 'bf',
                'Malawi': 'mw',
                'Guinea-Bissau': 'gw',
                'Angola': 'ao',
                'Guatemala': 'gt',
                'Guinea': 'gn',
                'DR Congo': 'cd',
                'Russia': 'ru',
                'Latvia': 'lv',
                'Martinique': 'mq',
                'Kenya': 'ke',
                'England': 'gb',
                'Austria': 'at',
                'Uruguay': 'uy',
                'Mexico': 'mx'
            };
            return countryMap[country] || 'xx'; // Return 'xx' for unknown countries
        }

        function displayAttempt(guessedPlayer) {
            const attemptCount = document.querySelectorAll('.attempt').length + 1;

            const labelDiv = document.createElement('div');
            labelDiv.className = 'attempt-label';
            labelDiv.innerHTML = `
                <span>Ai incercat: ${guessedPlayer.Name}</span>
                <span class="attempt-number">Incercarea ${attemptCount}/8</span>
            `;

            const attemptDiv = document.createElement('div');
            attemptDiv.className = 'attempt';

            const fields = [
                { value: 'Team', type: 'team' },
                { value: 'Position', type: 'position' },
                { value: 'Nationality', type: 'nationality' },
                { value: 'Number', type: 'number' },
                { value: 'Age', type: 'age', transform: (val) => getAge(val) }
            ];

            fields.forEach(field => {
                const div = document.createElement('div');
                const actualValue = field.transform ? field.transform(guessedPlayer[field.value]) : guessedPlayer[field.value];
                const targetValue = field.transform ? field.transform(targetPlayer[field.value]) : targetPlayer[field.value];
                compareValue(actualValue, targetValue, div, field.type.toLowerCase(), guessedPlayer.TeamID);
                attemptDiv.appendChild(div);
            });

            const container = document.getElementById('attempts-container');
            container.prepend(labelDiv);
            container.prepend(attemptDiv);
        }

        function updateCorrectGuesses() {
            const correctGuessesDiv = document.getElementById('correct-guesses');
            const guessedAttributesDiv = correctGuessesDiv.querySelector('.guessed-attributes');
            let hasCorrectGuesses = false;

            // Clear previous content
            guessedAttributesDiv.innerHTML = '';

            // Check all attempts for correct guesses
            const attempts = document.querySelectorAll('.attempt');
            const correctAttributes = {
                team: { value: null, icon: 'üëï', label: 'Echipa' },
                position: { value: null, icon: 'üéØ', label: 'Pozitie' },
                nationality: { value: null, icon: 'üåç', label: 'Nationalitate' },
                number: { value: null, icon: '#Ô∏è‚É£', label: 'Numar' },
                age: { value: null, icon: 'üìÖ', label: 'Varsta' }
            };

            attempts.forEach(attempt => {
                const stats = attempt.querySelectorAll('.attempt-info');
                stats.forEach((stat, index) => {
                    if (stat.classList.contains('correct')) {
                        hasCorrectGuesses = true;
                        const keys = ['team', 'position', 'nationality', 'number', 'age'];
                        const key = keys[index];

                        if (!correctAttributes[key].value) {
                            if (key === 'team') {
                                correctAttributes[key].value = stat.querySelector('img').cloneNode(true);
                            } else if (key === 'nationality') {
                                correctAttributes[key].value = stat.querySelector('img').cloneNode(true);
                            } else {
                                correctAttributes[key].value = stat.textContent;
                            }
                        }
                    }
                });
            });

            // Display correct guesses
            if (hasCorrectGuesses) {
                Object.entries(correctAttributes).forEach(([key, attr]) => {
                    if (attr.value) {
                        const div = document.createElement('div');
                        div.className = 'guessed-attribute';

                        const iconSpan = document.createElement('span');
                        iconSpan.textContent = attr.icon;
                        div.appendChild(iconSpan);

                        if (attr.value instanceof HTMLImageElement) {
                            div.appendChild(attr.value);
                        } else {
                            const valueSpan = document.createElement('span');
                            valueSpan.textContent = attr.value;
                            div.appendChild(valueSpan);
                        }

                        guessedAttributesDiv.appendChild(div);
                    }
                });
                correctGuessesDiv.classList.remove('hidden');
            } else {
                correctGuessesDiv.classList.add('hidden');
            }
        }

        function handleGuess(guessedPlayer) {
            if (gameOver) return;

            // Show grid headers on first attempt
            document.querySelector('.grid-headers').classList.remove('hidden');

            displayAttempt(guessedPlayer);
            updateCorrectGuesses();
            remainingGuesses--;
            document.getElementById('remaining-guesses').textContent = `Incercari ramase: ${remainingGuesses}`;

            if (guessedPlayer.Name === targetPlayer.Name) {
                endGame(true);
            } else if (remainingGuesses === 0) {
                endGame(false);
            }
        }

        function endGame(won) {
            gameOver = true;
            const gameOverDiv = document.getElementById('game-over');
            const messageDiv = document.getElementById('game-over-message');
            const overlay = document.querySelector('.overlay');

            const attemptsUsed = 8 - remainingGuesses;
            const hintsUsed = 3 - hintsRemaining;

            if (won) {
                messageDiv.innerHTML = `
                    <h2>üéâ Felicitari! Ai castigat! üéâ</h2>
                    <div style="margin: 20px 0; line-height: 1.6;">
                        <p>L-ai gasit pe <strong>${targetPlayer.Name}</strong></p>
                        <p>Incercari folosite: ${attemptsUsed}/8</p>
                        <p>Indicii folosite: ${hintsUsed}/3</p>
                        ${attemptsUsed === 1 ? '<p>Joc perfect! Din prima incercare! üèÜ</p>' : ''}
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <h2>Joc Terminat!</h2>
                    <div style="margin: 20px 0; line-height: 1.6;">
                        <p>Jucatorul era <strong>${targetPlayer.Name}</strong></p>
                        <p>Incercari folosite: ${attemptsUsed}/8</p>
                        <p>Indicii folosite: ${hintsUsed}/3</p>
                    </div>
                `;
            }

            gameOverDiv.classList.remove('hidden');
            overlay.classList.add('active');
        }

        function setupSearch() {
            const searchInput = document.getElementById('player-search');
            const dropdown = document.getElementById('dropdown');

            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();

                if (searchTerm.length < 2) {
                    dropdown.style.display = 'none';
                    return;
                }

                const matches = players.filter(player =>
                    player.Name.toLowerCase().includes(searchTerm)
                );

                dropdown.innerHTML = '';
                matches.forEach(player => {
                    const div = document.createElement('div');
                    div.className = 'dropdown-item';

                    const playerImg = document.createElement('img');
                    playerImg.className = 'player-img';
                    playerImg.src = `https://cryptobully.s3.eu-north-1.amazonaws.com/fotbal-comedie/player_images/${player.PlayerID}.png`;
                    playerImg.onerror = () => {
                        playerImg.src = `https://cryptobully.s3.eu-north-1.amazonaws.com/fotbal-comedie/player_images/${player.PlayerID}.jpg`;
                        playerImg.onerror = () => {
                            playerImg.src = 'https://cryptobully.s3.eu-north-1.amazonaws.com/fotbal-comedie/placeholder.png';
                            playerImg.style.opacity = '0.5';
                        };
                    };

                    const playerInfo = document.createElement('div');
                    playerInfo.style.display = 'flex';
                    playerInfo.style.flexDirection = 'column';

                    const playerName = document.createElement('div');
                    playerName.style.fontWeight = 'bold';
                    playerName.style.marginRight = '10px';
                    playerName.textContent = player.Name;

                    // const playerAge = document.createElement('div');
                    // playerAge.style.fontSize = '0.8em';
                    // playerAge.style.color = '#888';
                    // playerAge.textContent = `${getAge(player.Age)} ani`;

                    playerInfo.appendChild(playerName);
                    // playerInfo.appendChild(playerAge);

                    const teamLogo = document.createElement('img');
                    teamLogo.className = 'team-logo';
                    teamLogo.src = `https://cryptobully.s3.eu-north-1.amazonaws.com/fotbal-comedie/team_logos/${player.TeamID}.png`;
                    teamLogo.onerror = () => {
                        teamLogo.src = `https://cryptobully.s3.eu-north-1.amazonaws.com/fotbal-comedie/team_logos/${player.TeamID}.jpg`;
                        teamLogo.onerror = () => {
                            teamLogo.src = 'https://cryptobully.s3.eu-north-1.amazonaws.com/fotbal-comedie/placeholder.png';
                            teamLogo.style.opacity = '0.5';
                        };
                    };

                    div.appendChild(playerImg);
                    div.appendChild(playerInfo);
                    div.appendChild(teamLogo);

                    div.addEventListener('click', () => {
                        handleGuess(player);
                        searchInput.value = '';
                        dropdown.style.display = 'none';
                    });

                    dropdown.appendChild(div);
                });

                dropdown.style.display = matches.length > 0 ? 'block' : 'none';
            });

            document.addEventListener('click', (e) => {
                if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.style.display = 'none';
                }
            });
        }

        function getHint() {
            if (gameOver || hintsRemaining <= 0) return;

            if (remainingGuesses <= 1) {
                const hintText = document.getElementById('hint-text');
                hintText.style.display = 'block';
                hintText.textContent = "Nu mai ai suficiente incercari pentru un indiciu!";
                return;
            }

            // Create an object to track which stats are already correct
            const correctStats = {
                Team: false,
                Position: false,
                Nationality: false,
                Age: false,
                Number: false
            };

            // Check attempts to see which stats were already guessed correctly
            const attempts = document.querySelectorAll('.attempt');
            attempts.forEach(attempt => {
                const stats = attempt.querySelectorAll('.attempt-info');
                stats.forEach((stat, index) => {
                    if (stat.classList.contains('correct')) {
                        switch (index) {
                            case 0: correctStats.Team = true; break;
                            case 1: correctStats.Position = true; break;
                            case 2: correctStats.Nationality = true; break;
                            case 3: correctStats.Number = true; break;
                            case 4: correctStats.Age = true; break;
                        }
                    }
                });
            });

            // Filter out hints for correctly guessed stats
            const availableHints = [];
            if (!correctStats.Team) availableHints.push(`Acest jucator joaca la ${targetPlayer.Team}`);
            if (!correctStats.Position) availableHints.push(`Pozitia acestui jucator este ${mapPosition(targetPlayer.Position)}`);
            if (!correctStats.Nationality) availableHints.push(`Nationalitatea acestui jucator este ${targetPlayer.Nationality}`);
            if (!correctStats.Age) availableHints.push(`Varsta acestui jucator este ${getAge(targetPlayer.Age)}`);
            if (!correctStats.Number) availableHints.push(`Numarul acestui jucator este ${targetPlayer.Number}`);

            // Filter out previously used hints
            const unusedHints = availableHints.filter(hint => !usedHints.has(hint));

            if (unusedHints.length === 0) {
                document.getElementById('hint-text').textContent = "Nu mai sunt indicii disponibile!";
                return;
            }

            const randomHint = unusedHints[Math.floor(Math.random() * unusedHints.length)];
            usedHints.add(randomHint);

            const hintText = document.getElementById('hint-text');
            hintText.style.display = 'block';
            hintText.textContent = randomHint;

            hintsRemaining--;
            updateHintButtonText();
            remainingGuesses--;
            document.getElementById('remaining-guesses').textContent = `Incercari ramase: ${remainingGuesses}`;

            if (remainingGuesses === 0) {
                endGame(false);
            }
        }

        document.getElementById('play-again').addEventListener('click', startNewGame);
        document.getElementById('hint-button').addEventListener('click', getHint);

        // Initialize the game
        fetchPlayers();
        setupSearch();

        // Add this event listener
        window.addEventListener('resize', updateHintButtonText);
    </script>
</body>

</html>